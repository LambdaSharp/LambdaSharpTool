---
title: LambdaSharp.Core Log Records - CloudWatch Log Entries converted by LambdaSharp.Core - LambdaSharp
description: Description of S3 Log Records generated by processing CloudWatch Log entries
keywords: cloudwatch, records, logs, modules
---

# Log Records

All ingested CloudWatch log entries are stored in an S3 logging bucket when _Core Services_ are enabled. During ingestion, the _LambdaSharp.Core_ module parses and converts the CloudWatch Log entries into JSON records. This enables [Amazon Athena](https://aws.amazon.com/athena/) to query the ingested CloudWatch log entries.

## Record Schema

The log record schema has the following fields.

```yaml
Timestamp: Long
ModuleInfo: String
Module: String
ModuleId: String
Function: String
FunctionId: String
Tier: String
RecordType: String
Record: String
```

## Record Fields

<dl>

<dt><code>Timestamp</code></dt>
<dd>

The <code>Timestamp</code> attribute holds the UNIX epoch timestamp in milliseconds.

<i>Type</i>: Long
</dd>

<dt><code>ModuleInfo</code></dt>
<dd>

The <code>ModuleInfo</code> attribute holds the module name, version, and origin information.

<i>Type</i>: String
</dd>

<dt><code>Module</code></dt>
<dd>

The <code>Module</code> attribute holds the module name.

<i>Type</i>: String
</dd>

<dt><code>ModuleId</code></dt>
<dd>

The <code>ModuleId</code> attribute holds the CloudFormation stack name.

<i>Type</i>: String
</dd>

<dt><code>Function</code></dt>
<dd>

The <code>Function</code> attribute holds the logical Lambda function name.

<i>Type</i>: String
</dd>

<dt><code>FunctionId</code></dt>
<dd>

The <code>FunctionId</code> attribute holds the Lambda function resource name.

<i>Type</i>: String
</dd>

<dt><code>Tier</code></dt>
<dd>

The <code>Tier</code> attribute holds the deployment tier name.

<i>Type</i>: String
</dd>

<dt><code>RecordType</code></dt>
<dd>

The <code>RecordType</code> attribute holds the type of log record. Must be one of <code>LambdaError</code>, <code>LambdaEvent</code>, <code>LambdaMetrics</code>, or <code>UsageReport</code>.

<i>Type</i>: String
</dd>

<dt><code>Record</code></dt>
<dd>

The <code>Record</code> attribute holds the contents of the log record as a serialized JSON string.

<i>Type</i>: String
</dd>

</dl>

## Athena Table

The following steps show how to setup an Athena database and table to query ingested CloudWatch Log entries.

### Step 1 - Create an Athena Database

If you haven't already done so, create an Athena database. Replace `MyDatabase` with a database name of your choice.

```sql
CREATE DATABASE MyDatabase;
```

### Step 2 - Create an Athena Table

Replace `<LOGGING-BUCKET>` with the S3 logging bucket name. The S3 logging bucket name can be found in the output of the `lash init` command or, anytime later, in the AWS console. To find the bucket name in the AWS console, got to the _CloudFormation_ service, select the _LambdaSharp.Core_ CloudFormation stack corresponding to the deployment tier, and select _Outputs_ on the tabbed view. The ARN of the S3 logging bucket is under the `LoggingBucket` output value. Note that the part after the last colon (`:`) is the bucket name.

By default, the log records are stored under the `logging-success/` prefix. Adjust the prefix according to your configuration.

Finally, replace `MyLogs` with a table name of your choice.

```sql
CREATE EXTERNAL TABLE IF NOT EXISTS MyDatabase.MyLogs (
  `Timestamp` bigint,
  `ModuleInfo` string,
  `Module` string,
  `ModuleId` string,
  `Function` string,
  `FunctionId` string,
  `Record` string,
  `RecordType` string
)
ROW FORMAT SERDE 'org.openx.data.jsonserde.JsonSerDe'
WITH SERDEPROPERTIES (
  'serialization.format' = '1'
) LOCATION 's3://<LOGGING-BUCKET>/logging-success/';
```

### Step 3 - Query Log Records from Athena

The following query fetches all log records for all modules and functions from the S3 logging bucket.

Make sure to replace `MyDatabase` and `MyLogs` with your database and table names, respectively.

```sql
SELECT *
FROM MyDatabase.MyLogs
ORDER BY Timestamp DESC;
```

### Example: Show Usage Reports by Used Duration

The following query summarizes all `UsageReport` records by count, average used duration in percent, and maximum used duration in percent. This query is useful to identify Lambda functions that may be running too close to their execution limit.

Make sure to replace `MyDatabase` and `MyLogs` with your database and table names, respectively.

```sql
SELECT
  Module,
  Function,
  Count(UsedDurationPercent) AS Count,
  Round(Avg(UsedDurationPercent), 2) AS AvgUsedDurationPercent,
  Round(Max(UsedDurationPercent), 2) AS MaxUsedDurationPercent
FROM (
  SELECT
    Module,
    Function,
    (100.0 * Cast(json_extract_scalar(Record, '$.UsedDurationPercent') AS REAL)) AS UsedDurationPercent
  FROM MyDatabase.MyLogs
  WHERE RecordType = 'UsageReport'
)
GROUP BY 1, 2
ORDER BY 5 DESC;
```


|Module       |Function        |Count|AvgUsedDurationPercent|MaxUsedDurationPercent|
|-------------|----------------|-----|----------------------|----------------------|
|Sample.Event |SenderFunction  |   10|                  6.82|                 16.93|
|Sample.Metric|MyFunction      |    4|                  2.02|                  8.07|
|Sample.Event |ReceiverFunction|   10|                  6.08|                  7.84|
