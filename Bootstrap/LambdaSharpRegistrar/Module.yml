Name: LambdaSharpRegistrar

Description: It watches you...

Version: 0.4

Pragmas:
  - no-module-registration

Inputs:

  - Name: LoggingStream
    Description: AWS Kinesis stream to monitor
    Import: LambdaSharp::LoggingStreamArn

Outputs:

  - CustomResource: LambdaSharp::Module::Registration
    Description: Custom resources for registering LambdaSharp modules
    Handler: RegistrationTopic

  - Export: ErrorReportTopic
    Description: SNS topic for LambdaSharp module errors
    Value: !Ref ErrorReportTopic

  - Export: UsageReportTopic
    Description: SNS topic for LambdaSharp function usage reports
    Value: !Ref UsageReportTopic

Parameters:

  - Name: LoggingStreamReference
    Value: !Ref LoggingStream
    Resource:
      Type: AWS::Kinesis::Stream
      Allow: Subscribe

  - Name: RegistrationTopic
    Description: Custom resource topic for registering LambdaSharp modules
    Resource:
      Type: AWS::SNS::Topic
      Allow: Subscribe

  - Name: ErrorReportTopic
    Description: Topic for publishing LambdaSharp module errors
    Resource:
      Type: AWS::SNS::Topic
      Allow: Publish

  - Name: UsageReportTopic
    Description: Topic for publishing LambdaSharp function usage reports
    Resource:
      Type: AWS::SNS::Topic
      Allow: Publish

Functions:

  - Name: ProcessLogEvents
    Description: Process log events from all LambdaSharp module functions
    Memory: 128
    Timeout: 30
    Sources:
      - Kinesis: LoggingStreamReference

  - Name: RegisterModule
    Description: Register LambdaSharp modules
    Memory: 128
    Timeout: 30
    Sources:
      - Topic: RegistrationTopic
