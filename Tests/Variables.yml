Module: TestModule
Description: LambdaSharp CloudFormation Test

Variables:

  - Var: SourceValueParameter
    Description: Literal value
    Scope: "*"
    Value: This is a literal value

  - Var: SourceExpressionParameter
    Description: CloudFormation !Ref expression
    Scope: "*"
    Value: !Ref SourceValueParameter

  - Var: SourceResourceParameter
    Description: CloudFormation Resource
    Scope: "*"
    Resource:
      Type: AWS::SNS::Topic
      Allow: Publish

  - Var: SourceValueListParameter
    Description: List of literal values
    Scope: "*"
    Value:
      - first
      - second
      - third

  - Var: SourceExpressionListParameter
    Description: List of literal values
    Scope: "*"
    Value:
      - !Ref SourceValueParameter
      - !Ref SourceExpressionParameter
      - !Ref SourceResourceParameter
      - literal value

  - Var: SourceParameterCollection
    Description: Description for collection parameter
    Scope: "*"
    Variables:

      - Var: FirstSourceValueParameter
        Description: Nested parameter with a literal value
        Scope: "*"
        Value: A nested literal source value

      - Var: SecondSourceResourceParameter
        Description: CloudFormation Resource
        Scope: "*"
        Resource:
          Type: AWS::SNS::Topic
          Allow: Publish
          Properties:
            DisplayName: !Ref SourceValueParameter

  - Var: SampleParameterCollection
    Description: Description for collection parameter
    Scope: "*"
    Variables:

      - Var: FirstNestedParameter
        Description: First nested parameter
        Scope: "*"
        Value: A literal value

      - Var: SecondNestedParameter
        Description: Second nested parameter
        Scope: "*"
        Value:
          - one
          - two
          - three

      - Var: ThirdNestedParameter
        Description: Third nested parameter
        Scope: "*"
        Value: arn:aws:sns:us-east-1:123456789012:SampleTopic
        Resource:
          Type: AWS::SNS::Topic
          Allow: Publish

      - Var: FourthNestedParameter
        Description: Fourth nested parameter
        Scope: "*"
        Resource:
          Type: AWS::SNS::Topic
          Allow: Subscribe

      - Var: FifthNestedParameter
        Description: Fifth nested parameter
        Scope: "*"
        Secret: AQICAHjeGw7GlEczkZKnuQaQHVYq...+CXNRhA/rkOSNUThq4ikMnVU2g==

      - Var: SixthNestedParameter
        Description: Sixth nested parameter
        Scope: "*"
        Secret: AQICAHjeGw7GlEczkZKnuQaQHVYq...+CXNRhA/rkOSNUThq4ikMnVU2g==
        EncryptionContext:
          Purpose: Security
          "Spe|cial": "Char|acter"

      - Var: SeventhParameter
        Description: Seventh nested parameter
        Scope: "*"
        Value: !Ref SingleResourceParameter

  - Var: OtherParameterCollection
    Description: Description for collection parameter
    Scope: "*"
    Value: This collection has a value
    Variables:

      - Var: FirstNestedParameter
        Description: Same name as first nested parameter in sample parameter collection
        Scope: "*"
        Value: Another literal value

  - Var: SingleResourceParameter
    Description: Second nested parameter
    Value: "arn:aws:sns:*:*:*"
    Scope: "*"
    Resource:
      Type: AWS::SNS::Topic
      Allow: Publish

  - Var: MultiResourceParameter
    Description: Second nested parameter
    Scope: "*"
    Value:
      - "arn:aws:sns:*:*:*"
      - "arn:aws:sns:*:*:*:*"
    Resource:
      Type: AWS::SNS::Topic
      Allow: Publish

  # !Ref reference use-cases
  - Var: SourceSubExpressions
    Description: CloudFormation !Sub expressions
    Scope: "*"
    Value:
      - !Sub "${SourceValueParameter}"
      - !Sub "${SourceExpressionParameter}"
      - !Sub "${SourceResourceParameter}"
      - !Sub "${SourceValueListParameter}"
      - !Sub "${SourceExpressionListParameter}"
      - !Sub "${SourceParameterCollection::FirstSourceValueParameter}"
      - !Sub "${SourceParameterCollection::SecondSourceResourceParameter}"
      - !Sub "${SourceParameterCollection::SecondSourceResourceParameter.TopicName}"

  # !Ref module variables
  - Var: MyModuleName
    Scope: "*"
    Value: !Ref Module::Name

  - Var: MyModuleId
    Scope: "*"
    Value: !Ref Module::Id

  - Var: MyModuleVersion
    Scope: "*"
    Value: !Ref Module::Version

  # Grant permissiont to resource-less AWS services
  - Var: RekognitionService
    Description: Permissions required for using AWS Rekognition
    Value: "*"
    Resource:
      Allow:
          - "rekognition:DetectFaces"
          - "rekognition:IndexFaces"
          - "rekognition:SearchFacesByImage"

Functions:

  - Function: Function
    Description: My function
    Memory: 128
    Timeout: 30
